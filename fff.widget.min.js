var finurligeFaktaWidget=function(){"use strict";function i(e){var t=(new RegExp("[?&]"+e+"=([^&]*)")).exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}function s(t,n){if(window._gaq===undefined){var i=r("<script />",{type:"text/javascript",async:!0,src:("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js"}),s=r("<script />",{type:"text/javascript",text:"var _gaq = _gaq || [];"});r("body").append(i).append(s)}n===!0&&_gaq.push(["fff._setAccount",e.GAProfile],["fff._setDomainName",document.location.host],["fff._trackPageview"]);for(var o in t)_gaq.push(["fff._setAccount",e.GAProfile],["fff._setDomainName",document.location.host],["fff._trackEvent","Finurlig Fakta",o,t[o]])}function o(){this.widget="",this.data={},this.params={},this.reloaded=!1,this.init=function(t,n){this.data=t,this.params=n,this.build(),this.style()},this.build=function(){this.widget=r("<div/>",{"class":"fffW-"+this.params.widget+" fffW-widget"}).append(r("<div />",{"class":"fffW-innerwrapper"}).append(r("<h2 />",{"class":"fffW-title",text:this.data.title})).append(r("<p />",{"class":"fffW-text"}).append(this.data.content)));if(this.params.button.reload){var t=this,n=r('<a class="fffw-button fffw-button-reload" href="#">Indl\u00e6s et nyt faktum</a>');r(".fffW-innerwrapper",this.widget).prepend(n),n.click(function(e){e.stopPropagation(),e.preventDefault(),t.params.tracking&&s({Reloaded:document.location.host}),t.params.guid=null,t.params.callback="finurligeFaktaWidget.reload",r(t.params.target).data("widget",t),f(t.params)})}r(".fffW-innerwrapper",this.widget).append(r("<p />",{"class":"fffW-slogan",text:"Viden fra biblioteket"})),this.widget.hide()},this.style=function(){switch(this.params.style.type){case"none":r(".fffW-slogan",this.widget).before(this.getSourceLinks()),r(".fffW-slogan",this.widget).before(this.getAuthor()),r(".fffW-slogan",this.widget).before(this.getOrganization());break;case"minimal":this.addCSS(this.params.widget,"minimal",this.params.style.color),r(".fffW-innerwrapper",this.widget).prepend('<span class="fffw-logo"></span>');break;case"normal":r(".fffW-slogan",this.widget).before(this.getSourceLinks()),r(".fffW-innerwrapper",this.widget).prepend('<span class="fffw-logo"></span>'),this.addCSS(this.params.widget,"normal",this.params.style.color);break;case"full":r(".fffW-slogan",this.widget).before(this.getSourceLinks()),r(".fffW-slogan",this.widget).before(this.getAuthor()),r(".fffW-slogan",this.widget).before(this.getOrganization()),r(".fffW-innerwrapper",this.widget).prepend('<span class="fffw-logo"></span>'),this.addCSS(this.params.widget,"full",this.params.style.color)}},this.addCSS=function(n,i,s){var o=e.widgetDomain+"css/fffw-"+n+"."+i+"."+s+".css";document.createStyleSheet?document.createStyleSheet(o):r("head").append('<link media="all" rel="stylesheet" href="'+o+'" type="text/css" />')},this.getSourceLinks=function(){var t=r("<div />",{"class":"fffW-external-links fffW-extra"}).append(r("<span />",{"class":"fffW-label",text:"L\u00e6s mere:"}));for(var n in this.data.sources)t.append(r("<a />",{"class":"fffw-link",rel:"external",href:this.data.sources[n].url,text:this.data.sources[n].title}));return t},this.getAuthor=function(){return r("<div />",{"class":"fffW-author fffW-extra"}).append(r("<span />",{text:"Forfatter:","class":"fffW-label"})).append(this.data.author)},this.getOrganization=function(){return r("<div />",{"class":"fffW-orgnization fffW-extra"}).append(r("<span />",{text:"Organisation:","class":"fffW-label"})).append(this.data.organization)},this.insert=function(){var t=r(this.params.target);if(t.length!=1)return alert("The target div was not found on the page. Please add it to the page and try again."),-1;t.html(this.widget),this.params.event.loadComplet!==null&&this.params.event.loadComplet(),this.show()},this.reload=function(t){var n=this;n.data=t,n.reloaded=!0,n.hide(function(){r(".fffW-title",n.widget).text(n.data.title),r(".fffW-text",n.widget).html(n.data.content);switch(n.params.style.type){case"none":case"normal":case"full":r(".fffW-external-links",n.widget).html(n.getSourceLinks()),r(".fffW-author",n.widget).html(n.getAuthor()),r(".fffW-orgnization",n.widget).html(n.getOrganization())}n.show()})},this.hide=function(t){this.widget.hide(0,function(){t&&t()})},this.show=function(t){this.widget.show(0,function(){t&&t()})}}function u(){}function a(){}function f(t){t.guid!==null?c(t):r.getJSON(e.domain+"?method=getGuid&callback=?",function(e){t.guid=e.guid,c(t)})}function l(e){var t=n[e.guid],i=r(t.target).data("widget");i.reload(e)}function c(t){var i="getFact";n[t.guid]=t,r.ajax({url:e.domain,cache:!0,data:{guid:t.guid,method:i},dataType:"jsonp",jsonp:"callback",jsonpCallback:t.callback})}function h(e){var t=n[e.guid],r;switch(t.widget){case"interactive":r=new u,r.init(e,t),r.insert();break;case"slidein":r=new a,r.init(e,t),r.createTarget(),r.insert();break;default:alert("The selected firnulig fakta widget type is not supported")}}function p(n){r=n,e.baseGuid=i("fffGuid"),r.each(fffWidgetConfig,function(n,i){i.guid=e.baseGuid,i=r.extend({},t,i),i.style.color||(i.style.color="default"),i.style.type||(i.style.type="minimal"),i.tracking&&s({"Loaded at":document.location.host,"Widget type":i.widget,"Widget style":i.style.type,"Widget color":i.style.color},!0),f(i)})}var e={domain:"//service.finurligefakta.dk/",widgetDomain:"//service.finurligefakta.dk/widgets/",baseGuid:null,GAProfile:"UA-33089188-1"},t={callback:"finurligeFaktaWidget.load",widget:"interactive",target:"#fffwidget",style:{type:"normal",color:"default"},tracking:!0,button:{reload:!0},event:{loadComplet:null}},n=[],r;return u.prototype=new o,u.prototype.show=function(){this.widget.fadeIn()},u.prototype.hide=function(e){this.widget.fadeOut(function(){e&&e()})},a.prototype=new o,a.prototype.createTarget=function(){var e;this.params.target.charAt(0)==="#"?e=r("<div />",{id:this.params.target.substring(1)}):e=r("<div />",{"class":this.params.target.substring(1)}),e.addClass("fffW-widget-wrapper"),r("body").append(e)},a.prototype.show=function(){var e=this;r(window).scrollTop()>=r(document).height()-(r(window).height()+10)&&e.slideIn(),r(window).scroll(function(){r(window).scrollTop()>=r(document).height()-(r(window).height()+10)&&e.slideIn()})},a.prototype.hide=function(e){this.reloaded?this.widget.fadeOut(function(){e&&e()}):r(".fffW-slidein").animate({width:"0px"},{complete:function(){r(".fffW-slidein").removeClass("active"),e&&e()}},1e3)},a.prototype.slideIn=function(){var e=this;if(e.reloaded)e.widget.fadeIn(),e.reloaded=!1;else{var t=r(".fffW-slidein");t.hasClass("active")||(e.widget.show(),t.width("0px").animate({width:"370px"},{complete:function(){t.addClass("active")}},1e3))}},{init:p,load:h,reload:l}}();(function(){"use strict";var e=30,t=function(){var r=document.getElementsByTagName("head");if(r.length===0){e-->0&&setTimeout(t,100);return}var i=document.createElement("script");i.src="//ajax.googleapis.com/ajax/libs/jquery/1.4.0/jquery.min.js",r[0].appendChild(i),n()},n=function(){if(typeof jQuery=="undefined"||parseFloat(jQuery.fn.jquery)<1.4){e-->0&&setTimeout(n,100);return}var t=jQuery.noConflict(!0);t(document).ready(function(){finurligeFaktaWidget.init(t)})};typeof jQuery!="undefined"&&parseFloat(jQuery.fn.jquery)>=1.4?jQuery(document).ready(function(){finurligeFaktaWidget.init(jQuery)}):t()})()